# 使用方法と機能詳細

## 基本的な使用方法

### 1. 検索UIの表示
1. Kintoneアプリの一覧画面で「データ検索UI表示」ボタンをクリック
2. 検索UIが表示されます

### 2. アプリケーションの選択
- **現在のアプリを選択**: 現在表示中のアプリを自動選択
- **アプリ一覧を表示**: スペース内の全アプリを一覧表示して選択（画面自動リセット機能付き）
- **直接入力**: アプリ名を直接入力

### 3. 検索条件の設定
1. アプリケーション名を入力または選択
2. 取得レコード数を指定（1-500）
3. LABELフィールドの表示設定を選択（チェックボックス）
4. 「検索実行」ボタンをクリック

### 4. 結果の確認
- スキーマ情報とレコードデータが表示されます
- CSV出力ボタンでデータをエクスポートできます

## 詳細機能

### テーブル表示機能
- **カラムリサイズ**: 全テーブル（スキーマ、レコード、サブテーブル）でマウスドラッグによるカラム幅調整
- **統一されたUI**: フィールドコードカラムのフォントとサイズをフィールド名カラムに統一
- **シンプルな表示**: 説明カラムを削除し、より見やすい表示に最適化
- **オプション詳細表示**: CSVと同等の詳細情報をブラウザ上で確認（改行区切りで可読性向上、プロパティ名はボールド体表示）
  - 選択肢型フィールド: 「選択肢キー:表示名」形式
  - 計算フィールド: 「計算式: [式]」形式
  - 関連レコード一覧フィールド: 関連アプリ、条件、絞り込み、表示フィールド、ソート情報
  - ルックアップフィールド: 参照アプリ、参照キー、フィールドマッピング、検索対象、絞り込み、ソート情報
  - グループフィールド: 「グループ内フィールド数: X」
  - サブテーブルフィールド: 「サブフィールド数: X」
  - その他フィールド: 「設定名=値」形式

### スキーマ表示の詳細
- **メインフィールド**: フィールドコード、名前、タイプ、必須、オプション詳細
- **サブフィールド**: グループ内・サブテーブル内フィールドを階層表示
- **視覚的区別**: サブフィールドは背景色とインデントで区別

### CSV出力の詳細
- **スキーマCSV**: 全フィールド情報（グループ・サブテーブル展開済み）
- **レコードCSV**: 基本レコードデータ
- **サブテーブル含むCSV**: サブテーブルデータも別セクションとして出力
- **文字エンコーディング**: UTF-8 BOM付き（Excel対応）
- **統一されたヘッダー**: 画面表示と完全に一致するヘッダー構成
- **高度なフィールド対応**:
  - **計算フィールド**: 計算式をオプション詳細に表示
  - **関連レコード一覧**: 関連アプリ、条件、表示フィールドなどの設定情報を表示
  - **ルックアップフィールド**: 参照アプリ、フィールドマッピング、検索条件などの詳細を表示
  - **リッチエディターフィールド**: HTMLタグを含む初期値もそのまま出力（後処理可能）
- **Excel表示注意**: 計算式にカンマ（,）が含まれる場合、Excelで正しく表示されない場合があります
  - この場合は、Excelの「テキストファイルウィザード」を使用して手動でCSVを開くことを推奨します

### LABELフィールド表示スイッチ
- **表示制御**: チェックボックスでLABELフィールドの表示/非表示を切り替え
- **デフォルト設定**: チェックボックスはデフォルトでON（LABELフィールドを表示）
- **スキーマ表示**: チェックボックス設定に基づいてLABELフィールドの表示/非表示を制御
- **レコード表示**: LABELフィールドは常に除外（データではないため）
- **CSV出力**: スキーマCSVはチェックボックス設定に従い、レコードCSVはLABELフィールドを除外
- **フィルタリング**: LABELフィールドを除外したスキーマで処理を実行

### 関連レコード一覧条件表示
- **条件詳細表示**: フィールド、関連フィールド、演算子、値を適切に分離して表示
- **ソート条件表示**: フィールド名と順序（asc/desc）を表示
- **絞り込み条件表示**: 複雑な条件構造を適切にフォーマット
- **field・relatedField対応**: 関連レコード一覧の条件でfieldとrelatedFieldの両方を表示

### LABELフィールド機能
- **フィールドコード**: LABELフィールドのフィールドコードを「FC未定義」で表示
- **フィールド名**: LABELフィールドのフィールド名を「FN未定義」で表示
- **全モジュール対応**: スキーマ表示、CSV出力、グループ内、サブテーブル内すべてで適用

## 機能一覧

### 表示機能
- **スキーマ表示**: フィールド構造の詳細表示（オプション詳細カラム付き）
- **レコードデータ表示**: テーブル形式での見やすい表示
- **サブテーブル表示**: 各サブテーブルを独立したテーブルとして表示（subtableDisplay.js使用時）
- **カラムリサイズ**: 全テーブルでマウスドラッグによる幅調整
- **統一されたUI**: フィールドコードカラムのフォントとサイズをフィールド名カラムに統一
- **シンプルな表示**: 説明カラムを削除し、より見やすい表示に最適化
- **LABELフィールド表示スイッチ**: スキーマ表示でのLABELフィールドの表示/非表示を切り替え可能（レコード表示は常に除外）

### 検索機能
- **アプリ名検索**: 部分一致でのアプリ検索
- **指定件数取得**: 1-500件の範囲でレコード取得
- **リアルタイム結果表示**: 即座に結果をテーブル表示
- **LABELフィールドフィルタリング**: 表示設定に基づくフィールドフィルタリング

### エクスポート機能
- **スキーマCSV**: 完全なフィールド情報（グループ・サブテーブル展開）
- **レコードCSV**: 基本レコードデータ
- **サブテーブル含むCSV**: サブテーブルデータも完全出力
- **Excel対応**: BOM付きUTF-8エンコーディング
- **統一されたヘッダー**: 画面表示と完全に一致するヘッダー構成
- **LABELフィールド**: LABELフィールドのフィールドコードを「FC未定義」、フィールド名を「FN未定義」で表示
- **HTMLタグ保持**: リッチエディターフィールドの初期値に含まれるHTMLタグをそのまま保持

### UI機能
- **アプリ選択**: 現在のアプリ自動選択・一覧からの選択・直接入力
- **メッセージシステム**: 成功・エラー・情報メッセージの表示
- **エラーハンドリング**: 詳細なエラー情報とガイダンス
- **レスポンシブUI**: 様々な画面サイズに対応
- **画面リセット**: アプリ一覧表示時の自動画面クリア
- **LABELフィールド表示スイッチ**: チェックボックスによる表示制御

### 高度な機能
- **グループフィールド対応**: グループ内フィールドの完全サポート
  - レイアウト情報からの詳細フィールド取得
  - `code`プロパティが存在しないフィールドの適切なキー生成
  - グループ内フィールド数の正確な表示
- **サブテーブル対応**: サブテーブルフィールドの完全サポート
- **計算フィールド対応**: 計算式の詳細表示
- **関連レコード一覧対応**: 関連アプリや条件設定の詳細表示
  - 条件とソート条件の詳細表示（field・relatedField対応）
- **ルックアップフィールド完全対応**: フィールドタイプに関係なくlookupプロパティを持つフィールドを処理
  - 参照アプリ、参照キー、フィールドマッピング、検索対象、絞り込み、ソート情報の詳細表示
  - グループ内・サブテーブル内のルックアップフィールドも完全対応
- **LABELフィールド対応**: ラベルフィールドの適切な表示・処理
  - レイアウトからLABELフィールドを収集しスキーマに追加
  - フィールドコード・フィールド名を「FC未定義」「FN未定義」で表示
  - 表示/非表示の切り替え機能
- **アプリ名表示機能**: 関連レコード一覧・ルックアップフィールドでのアプリ名自動表示
  - フォーマット: `アプリ名 (アプリID)` 形式で表示
  - 自動キャッシュ機能により効率的なアプリ名取得
  - アプリ名が取得できない場合は従来通り `AppID: アプリID` 形式で表示
  - CSV出力・UI表示両方に対応
- **オプション詳細**: 選択肢・設定値・フィールド数・計算式・参照情報の詳細表示
- **依存関係チェック**: モジュール読み込み状況の自動確認

## パフォーマンス最適化
- **大きなテーブル**: カラムリサイズ機能により必要な情報に集中して表示
- **サブテーブルデータ**: 必要に応じてsubtableDisplay.jsを読み込み
- **CSV出力**: 大量データの場合は段階的に出力することを推奨
- **ログ出力**: デバッグ用ログは必要最小限に最適化済み
- **LABELフィールド**: 不要な場合は表示スイッチをOFFにしてパフォーマンスを向上

## 注意事項
- **環境要件**: Kintone環境でのみ動作します
- **パフォーマンス**: 大量データの取得は時間がかかる場合があります（最大500件まで）
- **文字エンコーディング**: CSVファイルはUTF-8（BOM付き）でExcel対応
- **Excel CSV表示**: 計算式にカンマが含まれる場合、Excelで自動的にCSVを開くと列が正しく分割される場合があります。この場合は「データ」→「テキストファイル」から手動でインポートしてください
- **ブラウザ対応**: モダンブラウザ（Chrome、Firefox、Edge、Safari）推奨
- **権限**: アプリへの参照権限が必要です
- **ファイル読み込み順序**: 依存関係を守って正しい順序で読み込んでください
- **LABELフィールド**: レイアウトにのみ存在するLABELフィールドも適切に処理されます
- **表示省略**: LABELフィールドの実際のフィールドコードやラベル名はhtmlタグが混在し冗長になるので「FC未定義」「FN未定義」として表示します
- **HTMLタグ**: CSV出力ではリッチエディターフィールドの初期値に含まれるHTMLタグをそのまま保持します。必要に応じて後処理してください
